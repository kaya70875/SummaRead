(()=>{console.log("Content Loaded.");const t=()=>{document.querySelectorAll("span.highlight").forEach((t=>t.classList.remove("highlight")))};chrome.storage.onChanged.addListener((async(a,o)=>{if("sync"===o&&a.buttonActive){const o=a.buttonActive.newValue;if(console.log("Button state changed:",o),o){const t=await e();await n(t)}else t()}else if("sync"===o&&a.summaryLength){const o=a.summaryLength.newValue;if(console.log("Summary length changed:",o),o){t(),console.log("new",o);const a=await e();await n(a)}}}));const e=()=>new Promise((t=>{chrome.storage.sync.get(["summaryLength"],(async e=>{const n=e.summaryLength||200;t(n)}))})),n=async t=>{try{const e=await(async t=>{console.log("Fetching summary...",t);const e=Array.from(document.querySelectorAll("p")).map((t=>t.innerText)).join(" "),n=await fetch("http://127.0.0.1:8000/summarize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({paragraph:e,r:t||200})});return await n.json()})(t);(t=>{const e="string"==typeof t.summary?t.summary.split(".").map((t=>t.trim())).filter(Boolean):t.summary;new Mark(document.body).mark(e,{element:"span",className:"highlight",separateWordSearch:!1})})(e)}catch(t){console.error("Error fetching summary:",t)}};(async()=>{const a=await e();chrome.storage.sync.get(["buttonActive"],(async e=>{e.buttonActive?await n(a):t()}))})()})();